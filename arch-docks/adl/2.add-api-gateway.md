# Добавление API Gateway

Status: Approved

## Change Log

- \[created\]  2025-11-18
- \[approved\] 2025-11-18


## Context

В проекте есть набор контекстов предоставляющий свой API для взаимодействия:

- Weather
- City
- Auth

Со временем могут появиться и новые, тем самым у нас будет возрастать прямая связь между клиентами и отдельными сервисами, что будет привносить сложность в работе.

Так же у нас будет дублироваться обработка:
- CORS
- JWT

## Proposed Design

От API Gateway требуется:
- Убрать связаноость между клиентами и сервисами
- Унифицировать обработку CORS
- Унифицировать обработку JWT
- Добавить единую точку сбора логов
- Маршрутизация
- Rate limiting


## Considerations

### Альтернативы

Как альтернатива: мы можем оставить все как есть и не писать API Gateway.

Но в будущем возрастут накладные расходы на разработку в силу обилия дублирующего функционала, который придется реализовывать, а так же со временем введение API Gateway выйдет дороже, при сильной связанности между клиентами и сервисами.

### Выбор технологии

Как варианты способа реализации API Gateway я рассматриваю:

- Nginx
- Express
- Kong
- Traefik

#### Nginx

Достаточно проблемно реализует JWT: прдется добавлять поддержку Lua и разбираться еще и в этой технологии.

Все остальные возможности на должном уровне.

#### Express

Достаточно легок в разработке и освоении. Представляет из себя просто фреймворк для написания web-приложений. Весь функционал придется реализовывать самостоятельно, то в учебном приложении это скорее плюс, чем минус.

Реализован на JS, что является плюсом, так как это знакомая технология.

В реальных условиях является анти-паттерном, годится только в учебных целях.

#### Kong

Поддерживает все из коробки, имеет много возможностей и плагинов.
Но это новая технология, которую придется учить. Кроме того, он довольно тяжеловесный, а дешевизна инфраструктуры это очень важное требование в нашем случае.

#### Traefik

Быстрый и легкий прокси, с хорошей поддержкой K8s.
Проверку JWT можно реализовать как ForwardAuth.

### Риски

Основной риск в том, что я могу перегрузить свою VPS при введении дополнительных контейнеров и сервисов, но вклад API Gateway в это крайне минимален.

### Последствия

#### Положительные

- Упрощается схема аутентификации, проекта
- Упрощается маршрутизация
- Появляется единая точка логгирования запросов к бекенду
- Можно кэшировать данные на уровне API Gateway
- Унифицируется ряд политик (retry, CORS, таймауты и тд)

#### Отрицательные
- Дополнительная нагрузка на инфраструктуру
- 1 дополнительный hop из-за ForwardAuth
- Дополнительная технология с которой надо разобраться
- Появляется единая точка отказа (если не дублировать)

## Decision

Выбран Traefik. Он выдерживает баланс между субъективной интересностью, простотой использования и обширным функционалом, который в нем есть.

Так же с точки зрения пользы от обучения Traefic представляет из себя реальную систему, которая используется в production-среде.

## Other Related ADRs

Отсутствуют

